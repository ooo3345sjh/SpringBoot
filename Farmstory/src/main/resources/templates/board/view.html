<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">
<th:block layout:fragment="main">
    <main id="board" class="view">

        <table th:object = "${article}">
            <input type="hidden" name="no" th:value="*{no}">
            <caption>글보기</caption>
            <tr>
                <th>제목</th>
                <td><input type="text" name="title" th:value="*{title}" readonly/></td>
            </tr>
            <tr th:if="*{file == 1}">
                <th>파일</th>
                <td>
                    <a th:href="@{/gnb/download(fno=*{fileVO.fno})}">[[*{fileVO.oriName}]] </a>
                    <span>[[*{fileVO.download}]]</span>회 다운로드
                </td>
            </tr>
            <tr>
                <th>내용</th>
                <td><textarea name="content" readonly>[[*{content}]]</textarea></td>
            </tr>
        </table>

        <div>
            <a th:href="@{/gnb/delete(group=${param.group}, cate=${param.cate}, page=${param.page})}" class="btn btnRemove">삭제</a>
            <a th:href="@{/gnb/modify(group=${param.group}, cate=${param.cate}, page=${param.page}, no=${param.no})}" class="btn btnModify">수정</a>
            <a th:href="@{/gnb(group=${param.group}, cate=${param.cate}, page=${param.page})}" class="btn btnList">목록</a>
        </div>

        <!-- 댓글목록 -->
        <section class="commentList">
            <h3>댓글목록</h3>
            <article>
                <span class="nick">길동이</span>
                <span class="date">20-05-13</span>
                <p class="content">댓글 샘플입니다.</p>
                <div>
                    <a href="#" class="remove">삭제</a>
                    <a href="#" class="modify">수정</a>
                </div>
            </article>
            <p class="empty">등록된 댓글이 없습니다.</p>
        </section>

        <!-- 댓글쓰기 -->
        <section class="commentForm">
            <h3>댓글쓰기</h3>
            <textarea name="comment" placeholder="댓글내용 입력"></textarea>
            <div>
                <a href="#" class="btn btnCancel">취소</a>
                <input type="button" class="btn btnComplete" value="작성완료"/>
            </div>
        </section>
    </main>
</th:block>
<th:block layout:fragment="script">
    <script type="text/javascript">
        let showComment = function(){

            ajaxAPI("comment", jsonData, "post").then((response) => {

                if(response.result == 0)
                    alert('댓글 등록에 실패했습니다.');

            }).catch((errorMsg) => {
                console.log(errorMsg)
            });

        }

        window.onload = function() {
            const btnRemove = document.querySelector('.btnRemove');
            const btnGoList = document.querySelector('.btnList');
            const btnComplete = document.querySelector('.btnComplete');

            const inputComment = document.querySelector('textarea[name=comment]');

            // 게시물 삭제
            btnRemove.addEventListener("click", function(e){
                e.preventDefault();

                if(!confirm('정말 삭제 하시겠습니까?')) return;

                const urlParams = new URL(location.href).searchParams;
                const no = urlParams.get('no');
                const group = urlParams.get('group');
                const cate = urlParams.get('cate');
                const page = urlParams.get('page');

                let jsonData = {"group":group, "cate":cate, "page":page, "no":no};
                ajaxAPI("gnb/delete", jsonData, "post").then((response) => {

                    if(response.result =! 0)
                        location.href = contextPath + "gnb" + response.queryString;

                    else
                        alert('삭제에 실패했습니다.');

                }).catch((errorMsg) => {
                    console.log(errorMsg)
                });
            });


            btnComplete.addEventListener("click", function(e){

                // 댓글 내용
                let comment = inputComment.value;
                let no = document.querySelector('input[name=no]').value;

                let jsonData = {parent:no, comment:comment};
                ajaxAPI("comment", jsonData, "post").then((response) => {

                    if(response.result == 0)
                        alert('댓글 등록에 실패했습니다.');

                }).catch((errorMsg) => {
                    console.log(errorMsg)
                });
            });


        };
    </script>
</th:block>
</html>



